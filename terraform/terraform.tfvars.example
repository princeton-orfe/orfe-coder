# Coder on Azure AKS - Configuration
# Copy this file to terraform.tfvars and customize the values
# Or run: ./scripts/configure.sh for interactive setup

# =============================================================================
# REQUIRED: Azure Authentication
# =============================================================================
# Get these from your Azure Service Principal

subscription_id = "00000000-0000-0000-0000-000000000000"  # Your Azure Subscription ID
tenant_id       = "00000000-0000-0000-0000-000000000000"  # Your Entra ID Tenant ID
client_id       = "00000000-0000-0000-0000-000000000000"  # Service Principal App ID
client_secret   = "your-service-principal-secret"         # Service Principal Secret

# =============================================================================
# General Configuration
# =============================================================================

resource_group_name = "coder-rg"  # Azure resource group name
location        = "eastus"       # Azure region
department_name = "Research"     # Department name (used in OIDC button text)

# Resource tags
tags = {
  Environment = "Production"
  Department  = "Research"
  ManagedBy   = "Terraform"
  Application = "Coder"
}

# =============================================================================
# AKS Configuration (defaults optimized for small teams ≤10 people)
# =============================================================================

kubernetes_version = "1.28"            # Kubernetes version
node_count         = 1                 # Initial node count
node_vm_size       = "Standard_D2s_v3" # VM size (2 vCPU, 8GB RAM - good for ≤10 users)
enable_autoscaling = true              # Enable cluster autoscaler
min_node_count     = 1                 # Min nodes for autoscaler
max_node_count     = 5                 # Max nodes for autoscaler

# Optional: Azure AD groups with AKS admin access
aks_admin_group_ids = []

# =============================================================================
# PostgreSQL Configuration (defaults optimized for small teams)
# =============================================================================

postgres_sku        = "B_Standard_B1ms"  # Burstable, 1 vCPU (~$15/mo)
postgres_storage_mb = 32768              # 32 GB storage

# =============================================================================
# Network Access Configuration
# =============================================================================
# Options: "loadbalancer" (public IP + Entra ID auth), "wireguard" (VPN), "clusterip" (kubectl only)

network_access_type = "loadbalancer"  # Public access secured by Entra ID

# WireGuard VPN settings (only used if network_access_type = "wireguard")
# wireguard_port         = 51820
# wireguard_network_cidr = "10.10.0.0/24"
# wireguard_peers = []

# =============================================================================
# Backup Configuration
# =============================================================================

backup_retention_days      = 14     # PostgreSQL backup retention (7-35 days)
geo_redundant_backup       = false  # Enable for cross-region disaster recovery
enable_backup_export       = true   # Export backups to blob storage
backup_blob_retention_days = 365    # Long-term blob storage retention

# =============================================================================
# External Provisioners (Local Endpoints)
# =============================================================================
# Enable to allow laptops/desktops to run workspaces locally

enable_external_provisioners = false

# =============================================================================
# Coder Configuration
# =============================================================================

coder_version = "2.16.0"

# Domain configuration (optional - for custom domain with HTTPS)
coder_domain          = ""
coder_wildcard_domain = ""
enable_ingress        = false

# =============================================================================
# Entra ID (Azure AD) Configuration
# =============================================================================

# Restrict login to specific email domains (leave empty to allow all)
allowed_email_domains = []

# Sync Entra ID groups to Coder (for RBAC)
enable_group_sync = false
